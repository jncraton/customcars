<!DOCTYPE html>
<html lang=en>
<head>
<meta charset=utf-8 /> 
<meta name=viewport content="width=device-width, initial-scale=1"/>
<title>Custom Cars</title>
<style>
* {
  margin:0;
  padding:0;
}
html,body {
  width:80vw;
  height:45vw;
  margin: 0 auto;
}
canvas {
  width:100%;
  height:100%;
  image-rendering: crisp-edges;
}
</style>
</head>
<body>
<canvas width=320 height=180></canvas>

<script>
const canvas = document.querySelector('canvas')
const ctx = canvas.getContext('2d')

let color = 0

const colors = [
  'white',
  'gray',
  'black',
  'red',
  'orange',
  'yellow',
  'green',
  'blue',
  'purple',
]

const chars = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-_?/:@.~!$&'()*+,="

if (location.hash.length < 90) {
  location.hash = '#' + Array(13*7).join(0)
}

function redraw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  colors.forEach((color, i) => {
    ctx.fillStyle = color
    ctx.fillRect(
      0,
      i * 20,
      20,
      20,
    )  
  })

  for (x=0; x<13; x++) {
    for (y=0; y<7; y++) {
      ctx.fillStyle = colors[chars.indexOf(location.hash[1 + 13*y + x])]
      ctx.fillRect(
        (x+2) * 20,
        (y+1) * 20,
        20,
        20,
      )    
    }
  }
}
redraw()

canvas.addEventListener('click', e => {
  let x = (e.clientX - canvas.getBoundingClientRect().x) * canvas.width / canvas.clientWidth
  x = Math.floor(x / 20)
  let y = (e.clientY - canvas.getBoundingClientRect().y) * canvas.height / canvas.clientHeight
  y = Math.floor(y / 20)
  console.log(x,y)
  if (x == 0) {
    color = y
  } else {
    if (x >= 2 && x <= 14 && y >= 1 && y <= 7) {
      x -= 2
      y -= 1
      let pixels = location.hash.split('')
      console.log(pixels,chars[color])
      pixels[1 + 13*y + x] = chars[color]
      location.hash = pixels.join('')
      redraw()
    }
  }
})
</script>

</body>
</html>